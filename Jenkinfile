properties([pipelineTriggers([githubPush()])]) 

node('linux'){
    stage('Setup'){
        git 'https://github.com/kehindek/wk11.git'
   withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'aws-credentials', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY'], [$class: 'AmazonWebServicesCredentialsBinding', accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'aws-credentials', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY']]) {
    // some block
     sh "aws s3 cp s3://kehindek-assignment-4/classweb.html /workspace/docker-pipeline/index.html"
}
    
    stage('Build Stage'){
       // This step should not normally be used in your script. Consult the inline help for details.
withDockerContainer('classweb') {
    // some block
   
FROM nginx
RUN yum update -y
LABEL maintainer = "Kenny Kalejaiye Kale5555@stthomas.edu"
ENV NGINX_PORT 80
EXPOSE 80
#RUN apt-get install build-essential -y
COPY html/index.html /usr/share/nginx/html
docker build -t classweb:1.0 .

}

    }
     stage('Test Stage'){
// This step should not normally be used in your script. Consult the inline help for details.
withDockerContainer('classweb') {
    // some block
    docker run --env NGINX_PORT="80"
     docker run -d -p NGINX_PORT:80 --name classweb1

}

     }
  
}
